# 字段配置系统使用指南

## 一、系统概述

本系统实现了类似飞书多维表格/Airtable的字段类型化管理功能,支持:
- ✅ 字段类型定义(17种字段类型)
- ✅ 字段属性配置(必填、唯一、主字段等)
- ✅ 字段可见性控制
- ✅ 字段排序和列宽设置
- ✅ 多表格配置管理
- 🚧 视图配置(表格、看板、日历、画廊)
- 🚧 动态表单生成
- 🚧 应用模式组织

## 二、字段类型说明

### 1. 常规类型
- **文本(text)**: 单行文本输入
- **数字(number)**: 数字输入,支持小数
- **日期(date)**: 日期选择器
- **日期时间(datetime)**: 日期时间选择器
- **复选框(checkbox)**: 布尔值,是/否
- **链接(url)**: URL地址
- **邮箱(email)**: 邮箱地址
- **电话(phone)**: 电话号码

### 2. 选择类型
- **单选(select)**: 从预定义选项中选择一个
- **多选(multi_select)**: 从预定义选项中选择多个

### 3. 关联类型
- **关联(relation)**: 关联其他表格的记录
- **附件(attachment)**: 文件上传

### 4. 高级类型
- **公式(formula)**: 根据其他字段计算
- **创建时间(created_time)**: 自动记录创建时间
- **修改时间(updated_time)**: 自动记录最后修改时间
- **创建人(created_by)**: 自动记录创建人
- **修改人(updated_by)**: 自动记录最后修改人

## 三、字段属性说明

### 1. 基础属性
- **字段名称**: 数据库字段名(英文,不可修改)
- **显示名称**: 用户界面显示的名称(中文)
- **字段类型**: 从17种类型中选择
- **字段说明**: 字段的详细说明

### 2. 约束属性
- **必填**: 该字段是否必须填写
- **唯一**: 该字段值是否必须唯一
- **主字段**: 是否为表格的主要标识字段
- **系统字段**: 系统字段不可删除

### 3. 显示属性
- **可见**: 是否在界面上显示
- **列宽**: 表格列的宽度(像素)
- **排序**: 字段在表格中的显示顺序

### 4. 默认值
- **默认值**: 新建记录时的默认值

## 四、使用流程

### 1. 访问字段配置页面
- 登录系统后,点击侧边栏"系统管理" → "字段配置"
- 仅管理员可以访问此页面

### 2. 选择表格
- 页面顶部显示所有可配置的表格(入库管理、出库管理、产品管理等)
- 点击标签页切换不同表格

### 3. 查看字段配置
- 表格显示当前表格的所有字段配置
- 包括字段名称、类型、属性等信息

### 4. 新增字段
1. 点击"新增字段"按钮
2. 填写字段信息:
   - 字段名称(英文,如: product_code)
   - 显示名称(中文,如: 产品编号)
   - 选择字段类型
   - 设置字段属性(必填、唯一等)
   - 设置列宽和排序
3. 点击"创建"保存

### 5. 编辑字段
1. 点击字段行的编辑按钮
2. 修改字段属性(字段名称不可修改)
3. 点击"更新"保存

### 6. 删除字段
1. 点击字段行的删除按钮
2. 确认删除操作
3. 注意:系统字段不可删除

### 7. 控制字段可见性
- 点击眼睛图标可以快速切换字段的可见性
- 隐藏的字段不会在表格中显示

## 五、数据库结构

### 1. applications表
存储应用配置,一个应用可以包含多个表格。

### 2. table_configs表
存储表格配置,关联到具体的数据库表。

### 3. field_configs表
存储字段配置,定义每个字段的类型和属性。

### 4. view_configs表
存储视图配置,定义不同的数据展示方式。

## 六、已配置的表格

### 1. 入库管理(inbound_orders)
- 入库单号(text, 主字段)
- 入库类型(select)
- 入库日期(date)
- 供应商(relation)
- 状态(select)
- 备注(text)
- 创建时间(created_time)

### 2. 出库管理(outbound_orders)
- 出库单号(text, 主字段)
- 出库类型(select)
- 出库日期(date)
- 客户(relation)
- 软件版本(relation)
- 状态(select)
- 备注(text)
- 创建时间(created_time)

### 3. 产品管理(products)
- 产品编号(text, 主字段)
- 产品名称(text)
- 规格型号(text)
- 单位(text)
- 生产企业(text)
- 创建时间(created_time)

## 七、后续开发计划

### 1. 动态表单生成(Phase 2)
- 根据字段配置自动生成表单
- 根据字段类型渲染不同的输入组件
- 动态验证规则

### 2. 视图系统(Phase 3)
- 表格视图:传统表格展示
- 看板视图:按状态分组的卡片展示
- 日历视图:按日期展示
- 画廊视图:图片为主的展示

### 3. 字段选项配置(Phase 4)
- 单选/多选的选项管理
- 关联字段的目标表配置
- 公式字段的表达式编辑

### 4. 应用模式(Phase 5)
- 将多个表格组织成应用
- 应用级别的权限控制
- 应用模板和复制

## 八、注意事项

1. **字段名称不可修改**: 字段创建后,字段名称(field_name)不可修改,因为它对应数据库字段
2. **系统字段不可删除**: 标记为系统字段的字段不可删除,以保证系统正常运行
3. **权限控制**: 只有管理员可以配置字段,普通用户只能查看
4. **数据一致性**: 修改字段配置不会影响已有数据,但可能影响数据展示
5. **谨慎删除**: 删除字段配置不会删除数据库字段,但会影响界面显示

## 九、常见问题

### Q1: 如何添加单选字段的选项?
A: 当前版本暂不支持选项配置,将在Phase 4实现。

### Q2: 如何配置关联字段?
A: 当前版本暂不支持关联配置,将在Phase 4实现。

### Q3: 字段配置后如何在界面上生效?
A: 当前版本需要手动修改页面代码,Phase 2将实现动态表单生成。

### Q4: 可以配置自定义表格吗?
A: 当前版本只支持预定义的表格,Phase 5将支持自定义表格。

## 十、技术架构

### 1. 数据层
- Supabase PostgreSQL数据库
- RLS行级安全策略
- 外键关联和级联删除

### 2. API层
- TypeScript类型定义
- Supabase客户端封装
- 统一的错误处理

### 3. UI层
- React + TypeScript
- shadcn/ui组件库
- React Hook Form表单管理

### 4. 权限控制
- 基于角色的访问控制(RBAC)
- 管理员专属功能
- RLS策略保护数据

## 十一、开发指南

### 1. 添加新的字段类型
1. 在`database.ts`中添加类型定义
2. 在`FieldConfigPage.tsx`中添加选项
3. 实现对应的渲染组件(Phase 2)

### 2. 添加新的表格配置
1. 在数据库迁移中插入table_configs记录
2. 插入对应的field_configs记录
3. 创建默认视图配置

### 3. 扩展字段属性
1. 修改field_configs表结构
2. 更新FieldConfig类型定义
3. 更新FieldConfigPage表单

---

**版本**: v1.0.0  
**更新日期**: 2026-01-13  
**作者**: 库存管理系统开发团队
